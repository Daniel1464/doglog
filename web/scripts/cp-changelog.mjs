import path from 'path';
import fs from 'fs/promises';

const CHANGELOG_INPUT_PATH = path.join(import.meta.dirname, '..', '..', 'CHANGELOG.md');
const OUTPUT_PATH = path.join(import.meta.dirname, '..', 'src', 'content', 'docs', 'reference', 'changelog.md');

const rawChangelog = await fs.readFile(CHANGELOG_INPUT_PATH, 'utf-8');

const newChangelog =
	[
		'---',
		'# AUTOGENERATED - see cp-changelog.mjs',
		'title: Changelog',
		'description: Changelog of updates to DogLog.',
		'---',
		'',
	].join('\n') + rawChangelog.replace('# Changelog', '');

await fs.writeFile(OUTPUT_PATH, newChangelog);
console.log('Wrote changelog to', OUTPUT_PATH);
